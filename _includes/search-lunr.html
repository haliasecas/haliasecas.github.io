<script>
	window.store = {
		{%- for post in site.posts -%}
			{%- assign postWords = post.content | number_of_words -%}
			{%- assign excerptWords = post.excerpt | number_of_words -%}
			{%- assign author = site.data.authors[post.author] -%}

			{%- capture date -%}
				{%- include date-spanish.html item=post -%}
			{%- endcapture -%}

			{%- if postWords > excerptWords -%}
				{%- assign continue = 1 -%}
			{%- else -%}
				{%- assign continue = 0 -%}
			{%- endif -%}

			{%- if author -%}
				{%-
					assign authorName = author.name |
					append: " " |
					append: author.lastName |
					strip
				-%}
			{%- else -%}
				{%- assign authorName = post.author | strip -%}
			{%- endif -%}

	    "{{ post.id | strip | xml_escape }}": {
	      "title": {{ post.title | strip | jsonify }},
	      "author": {{ authorName | strip | jsonify }},
	      "categories": {{ post.categories | jsonify }},
				"content": {{
					post.content |
					newline_to_br |
					strip_newlines |
					replace: "<br />", " " |
					strip_html |
					strip |
					jsonify
				}},
	      "displayContent": {{ post.excerpt | strip | jsonify }},
	      "url": {{ post.url | strip | jsonify }},
	      "continue": {{ continue | strip }},
	      "date": {{ date | strip | jsonify }}
	    }{%- unless forloop.last -%},{%- endunless -%}

	  {%- endfor -%}
	};

	var idx = lunr(function() {
	  this.field('id');
	  this.field('title', { boost: 10 });
	  this.field('categories');
	  this.field('content');

	  for (var key in window.store) {
	    this.add({
	      'id': key,
	      'title': window.store[key].title,
	      'categories': window.store[key].categories,
	      'content': window.store[key].content,
	    });
	  }
	});
</script>
